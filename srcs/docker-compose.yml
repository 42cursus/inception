version: "3.8"

#Les variables d'environnement doivent toutes etre dans un fichier .env
#Le tag latest est interdit, nous devons utiliser nos propres images.

#3 grandes sections - les services (=les containers), les networks (=la communication), 
#les volumes (les fichiers/ressources)

#Pour rappel nous travaillons LEMP Stack

#Attention l'indentation est tres important dans un fichier yaml 

#https://docs.docker.com/compose/networking/
#Each container for a service joins the default network and is both reachable
#by other containers on that network, and "discoverable"vy then at a hostname identical to the container name
networks:
        localhost:
                name: inception_network

#https://docs.docker.com/storage/volumes/
#Volumes are the preferred mechanism for persisting data generated by and used by Docker containers. 
#Volumes are "completely managed by Docker"       
volumes:
        wordpress:
                name: wordpress
                #voir si besoin d'ajouter un driver avec des options ?
        mariadb:
                name: mariadb

#Nos containers/services
services:
        mariadb:  
            container_name: mariadb_inception
            build: ./mariadb
            volumes:
                    - mariadb:/var/lib/mysql
            networks:
                    - localhost
            image: mariadb
            restart: always
        wordpress:
            depends_on:
                - mariadb
            container_name: wordpress_inception
            build: ./wordpress
            image: wordpress
            volumes:
                - wordpress:/var/www/wordpress
            networks:
                - localhost
            restart: always
        nginx:
            depends_on:
                - wordpress
            container_name: nginx_inception
            build: ./nginx
            image: nginx
            #Only accessible port as requested
            ports:
                - "443:443"
            volumes:
                - wordpress:/var/www/wordpress
            networks:
                - localhost
            restart: always
